<!DOCTYPE HTML>
<html> <head> <title>Containerizing Critical VoLTE Infrastructure: Lessons from Production IMS Deployment - Future Imperfect</title> <meta charset="utf-8" /> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" /> <link rel="stylesheet" href="../assets/css/main.css" /> <link rel="stylesheet" href="../assets/css/codehilite.css" /> </head> <body class="single is-preload"> <div id="wrapper"> <header id="header"> <h1><a href="../index.html">Future Imperfect</a></h1> <nav class="links"></nav> </header> <div id="main"> <article class="post"> <header> <div class="title"><h2>Containerizing Critical VoLTE Infrastructure: Lessons from Production IMS Deployment</h2><p>Containerization has revolutionized how we deploy and manage applications, but applying these principles to mission-critical telecommunications infrastructure presents unique challenges. Recently, I led the containerization of a production VoLTE IMS (IP Multimedia Subsystem) that serves millions of voice calls daily.</p></div> <div class="meta"><span class="published">Containers</span></div> </header> <div class="content markdown"><h1>Containerizing Critical VoLTE Infrastructure: Lessons from Production IMS Deployment</h1>
<h2>Introduction</h2>
<p>Containerization has revolutionized how we deploy and manage applications, but applying these principles to mission-critical telecommunications infrastructure presents unique challenges. Recently, I led the containerization of a production VoLTE IMS (IP Multimedia Subsystem) that serves millions of voice calls daily.</p>
<p>This wasn't just about putting applications in Docker containers – it was about maintaining 99.99% uptime while transforming the deployment architecture of systems that telecommunications providers depend on for revenue-generating services.</p>
<h2>The Telecommunications Context</h2>
<h3>What Makes Telecom Different</h3>
<p>VoLTE systems have requirements that typical web applications don't face:</p>
<p><strong>Ultra-High Availability</strong>: Downtime directly impacts customer calls and emergency services
<strong>Real-time Performance</strong>: Latency measured in milliseconds affects call quality
<strong>Regulatory Compliance</strong>: Strict requirements for data handling and service continuity<br />
<strong>Complex Networking</strong>: SIP signaling, RTP media streams, and diameter protocol integration
<strong>Stateful Services</strong>: Session management across multiple network elements</p>
<h3>The Legacy Challenge</h3>
<p>Our starting point was a traditional deployment model:
- Bare metal servers with manual configuration
- Monolithic application bundles
- Custom deployment scripts
- Environment-specific configurations hardcoded in files
- Manual scaling and recovery processes</p>
<h2>Containerization Strategy</h2>
<h3>Phase 1: Understanding the Application Architecture</h3>
<p>Before containerizing, I needed to deeply understand our IMS components:</p>
<p><strong>I-CSCF (Interrogating CSCF)</strong>:
- SIP routing and HSS queries
- Stateless request processing
- High-frequency database lookups</p>
<p><strong>P-CSCF (Proxy CSCF)</strong>:
- First contact point for mobile devices
- NAT traversal and security enforcement
- RTP media plane coordination</p>
<p><strong>S-CSCF (Serving CSCF)</strong>:
- Session state management
- Subscriber service logic
- Complex routing decisions</p>
<h3>Phase 2: Container Design Principles</h3>
<p>I established key principles for our containerization:</p>
<p><strong>1. Single Responsibility</strong>
Each container runs one IMS function:</p>
<div class="codehilite"><pre><span></span><code><span class="c"># Dedicated I-CSCF container</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">ubuntu:20.04</span>
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>kamailio-ims-modules
<span class="k">COPY</span><span class="w"> </span>icscf-config/<span class="w"> </span>/etc/kamailio/
<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/usr/sbin/kamailio&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-f&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;/etc/kamailio/icscf.cfg&quot;</span><span class="p">]</span>
</code></pre></div> <p><strong>2. Configuration Externalization</strong>
All configuration moved to environment variables and mounted volumes:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Runtime configuration injection</span>
envsubst<span class="w"> </span>&lt;<span class="w"> </span>/templates/icscf.cfg.tpl<span class="w"> </span>&gt;<span class="w"> </span>/etc/kamailio/icscf.cfg
</code></pre></div> <p><strong>3. Statelessness Where Possible</strong>
- Moved session state to external databases
- Used Redis for distributed caching
- Designed for horizontal scaling</p>
<h2>Multi-Stage Build Optimization</h2>
<h3>The Challenge: Large Base Images</h3>
<p>Kamailio IMS builds required numerous development dependencies, creating bloated containers unsuitable for production:</p>
<div class="codehilite"><pre><span></span><code><span class="c"># Before: Single-stage build (1.2GB image)</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">ubuntu:20.04</span>
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>build-essential<span class="w"> </span>gcc<span class="w"> </span>g++<span class="w"> </span>make<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>libssl-dev<span class="w"> </span>libxml2-dev<span class="w"> </span>libpq-dev<span class="w"> </span>mysql-dev<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>#<span class="w"> </span>...<span class="w"> </span>many<span class="w"> </span>more<span class="w"> </span>build<span class="w"> </span>dependencies
<span class="k">COPY</span><span class="w"> </span>src/<span class="w"> </span>/build/
<span class="k">RUN</span><span class="w"> </span>make<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>install
<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/usr/local/sbin/kamailio&quot;</span><span class="p">]</span>
</code></pre></div> <h3>Solution: Optimized Multi-Stage Builds</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Stage 1: Build environment</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">ubuntu:20.04</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">builder</span>
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>build-essential<span class="w"> </span>gcc<span class="w"> </span>g++<span class="w"> </span>make<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>libssl-dev<span class="w"> </span>libxml2-dev<span class="w"> </span>libpq-dev<span class="w"> </span>mysql-dev <span class="k">COPY</span><span class="w"> </span>kamailio-source/<span class="w"> </span>/build/kamailio/
<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/build/kamailio</span>
<span class="k">RUN</span><span class="w"> </span>make<span class="w"> </span>cfg<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>all <span class="c"># Stage 2: Runtime environment </span>
<span class="k">FROM</span><span class="w"> </span><span class="s">ubuntu:20.04</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">runtime</span>
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>libssl1.1<span class="w"> </span>libxml2<span class="w"> </span>libpq5<span class="w"> </span>mysql-client<span class="w"> </span><span class="se">\</span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/var/lib/apt/lists/* <span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/build/kamailio/src/kamailio<span class="w"> </span>/usr/sbin/
<span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/build/kamailio/modules/<span class="w"> </span>/usr/lib/kamailio/modules/
<span class="k">COPY</span><span class="w"> </span>config-templates/<span class="w"> </span>/templates/
<span class="k">COPY</span><span class="w"> </span>entrypoint.sh<span class="w"> </span>/entrypoint.sh <span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/entrypoint.sh&quot;</span><span class="p">]</span>
</code></pre></div> <p><strong>Results:</strong>
- Image size reduced from 1.2GB to 280MB (76% reduction)
- Faster deployment times
- Reduced attack surface in production</p>
<h2>Dynamic Configuration Management</h2>
<h3>The Template System</h3>
<p>I developed a sophisticated configuration template system to handle the complexity of IMS networking:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># entrypoint.sh - Dynamic configuration generation</span> <span class="c1"># Network topology variables</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">INTERNAL_IP</span><span class="o">=</span><span class="k">$(</span>hostname<span class="w"> </span>-I<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">DNS_SERVERS</span><span class="o">=</span><span class="si">${</span><span class="nv">DNS_IP</span><span class="k">:-</span><span class="s2">&quot;172.20.0.3&quot;</span><span class="si">}</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">MYSQL_HOST</span><span class="o">=</span><span class="si">${</span><span class="nv">MYSQL_IP</span><span class="k">:-</span><span class="s2">&quot;172.20.0.2&quot;</span><span class="si">}</span> <span class="c1"># IMS realm configuration </span>
<span class="nb">export</span><span class="w"> </span><span class="nv">IMS_DOMAIN</span><span class="o">=</span><span class="si">${</span><span class="nv">IMS_REALM</span><span class="k">:-</span><span class="s2">&quot;ims.mnc001.mcc001.3gppnetwork.org&quot;</span><span class="si">}</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">EPC_DOMAIN</span><span class="o">=</span><span class="si">${</span><span class="nv">EPC_REALM</span><span class="k">:-</span><span class="s2">&quot;epc.mnc001.mcc001.3gppnetwork.org&quot;</span><span class="si">}</span> <span class="c1"># Generate service-specific configuration</span>
<span class="k">case</span><span class="w"> </span><span class="nv">$SERVICE_TYPE</span><span class="w"> </span><span class="k">in</span>
<span class="w"> </span><span class="s2">&quot;icscf&quot;</span><span class="o">)</span>
<span class="w"> </span>envsubst<span class="w"> </span>&lt;<span class="w"> </span>/templates/icscf.cfg.tpl<span class="w"> </span>&gt;<span class="w"> </span>/etc/kamailio/icscf.cfg
<span class="w"> </span>envsubst<span class="w"> </span>&lt;<span class="w"> </span>/templates/icscf.xml.tpl<span class="w"> </span>&gt;<span class="w"> </span>/etc/kamailio/icscf.xml
<span class="w"> </span><span class="p">;;</span>
<span class="w"> </span><span class="s2">&quot;pcscf&quot;</span><span class="o">)</span>
<span class="w"> </span>envsubst<span class="w"> </span>&lt;<span class="w"> </span>/templates/pcscf.cfg.tpl<span class="w"> </span>&gt;<span class="w"> </span>/etc/kamailio/pcscf.cfg
<span class="w"> </span>envsubst<span class="w"> </span>&lt;<span class="w"> </span>/templates/pcscf.xml.tpl<span class="w"> </span>&gt;<span class="w"> </span>/etc/kamailio/pcscf.xml
<span class="w"> </span><span class="p">;;</span>
<span class="w"> </span><span class="s2">&quot;scscf&quot;</span><span class="o">)</span>
<span class="w"> </span>envsubst<span class="w"> </span>&lt;<span class="w"> </span>/templates/scscf.cfg.tpl<span class="w"> </span>&gt;<span class="w"> </span>/etc/kamailio/scscf.cfg<span class="w"> </span>
<span class="w"> </span>envsubst<span class="w"> </span>&lt;<span class="w"> </span>/templates/scscf.xml.tpl<span class="w"> </span>&gt;<span class="w"> </span>/etc/kamailio/scscf.xml
<span class="w"> </span><span class="p">;;</span>
<span class="k">esac</span> <span class="c1"># Start the appropriate service</span>
<span class="nb">exec</span><span class="w"> </span>/usr/sbin/kamailio<span class="w"> </span>-f<span class="w"> </span>/etc/kamailio/<span class="si">${</span><span class="nv">SERVICE_TYPE</span><span class="si">}</span>.cfg
</code></pre></div> <h3>Configuration Template Example</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># icscf.cfg.tpl - I-CSCF configuration template</span>
<span class="nv">listen</span><span class="o">=</span>udp:<span class="si">${</span><span class="nv">INTERNAL_IP</span><span class="si">}</span>:4060
<span class="nv">listen</span><span class="o">=</span>tcp:<span class="si">${</span><span class="nv">INTERNAL_IP</span><span class="si">}</span>:4060 <span class="c1"># Database connections</span>
modparam<span class="o">(</span><span class="s2">&quot;db_mysql&quot;</span>,<span class="w"> </span><span class="s2">&quot;ping_interval&quot;</span>,<span class="w"> </span><span class="m">300</span><span class="o">)</span>
modparam<span class="o">(</span><span class="s2">&quot;db_mysql&quot;</span>,<span class="w"> </span><span class="s2">&quot;timeout_interval&quot;</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
modparam<span class="o">(</span><span class="s2">&quot;db_mysql&quot;</span>,<span class="w"> </span><span class="s2">&quot;reconnect&quot;</span>,<span class="w"> </span><span class="m">1</span><span class="o">)</span> <span class="c1"># HSS Diameter configuration </span>
modparam<span class="o">(</span><span class="s2">&quot;ims_icscf&quot;</span>,<span class="w"> </span><span class="s2">&quot;db_url&quot;</span>,<span class="w"> </span>
<span class="w"> </span><span class="s2">&quot;mysql://icscf:</span><span class="si">${</span><span class="nv">MYSQL_PASSWORD</span><span class="si">}</span><span class="s2">@</span><span class="si">${</span><span class="nv">MYSQL_HOST</span><span class="si">}</span><span class="s2">/icscf&quot;</span><span class="o">)</span> <span class="c1"># Route set configuration</span>
modparam<span class="o">(</span><span class="s2">&quot;ims_icscf&quot;</span>,<span class="w"> </span><span class="s2">&quot;route_on_term_user_unknown&quot;</span>,<span class="w"> </span><span class="m">1</span><span class="o">)</span>
modparam<span class="o">(</span><span class="s2">&quot;ims_icscf&quot;</span>,<span class="w"> </span><span class="s2">&quot;scscf_entry_expiry&quot;</span>,<span class="w"> </span><span class="m">300</span><span class="o">)</span> <span class="c1"># Network routing</span>
route<span class="o">[</span>INIT_REQUESTS<span class="o">]</span><span class="w"> </span><span class="o">{</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>!mf_process_maxfwd_header<span class="o">(</span><span class="s2">&quot;10&quot;</span><span class="o">))</span><span class="w"> </span><span class="o">{</span>
<span class="w"> </span>send_reply<span class="o">(</span><span class="s2">&quot;483&quot;</span>,<span class="w"> </span><span class="s2">&quot;Too Many Hops&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w"> </span>exit<span class="p">;</span>
<span class="w"> </span><span class="o">}</span> <span class="w"> </span><span class="c1"># IMS domain routing</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="nv">uri</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span><span class="s2">&quot;.*@</span><span class="si">${</span><span class="nv">IMS_DOMAIN</span><span class="si">}</span><span class="s2">.*&quot;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w"> </span>route<span class="o">(</span>IMS_ROUTING<span class="o">)</span><span class="p">;</span>
<span class="w"> </span><span class="o">}</span>
<span class="o">}</span>
</code></pre></div> <h2>Networking and Service Discovery</h2>
<h3>Container Networking Architecture</h3>
<p>VoLTE requires complex networking between components. I implemented a custom Docker network configuration:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># docker-compose.yml</span>
<span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span> <span class="nt">services</span><span class="p">:</span>
<span class="w"> </span><span class="nt">dns</span><span class="p">:</span>
<span class="w"> </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./dns</span>
<span class="w"> </span><span class="nt">networks</span><span class="p">:</span>
<span class="w"> </span><span class="nt">ims-internal</span><span class="p">:</span>
<span class="w"> </span><span class="nt">ipv4_address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.20.0.3</span>
<span class="w"> </span><span class="nt">ports</span><span class="p">:</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;53:53/udp&quot;</span> <span class="w"> </span><span class="nt">mysql</span><span class="p">:</span>
<span class="w"> </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./mysql</span><span class="w"> </span>
<span class="w"> </span><span class="nt">networks</span><span class="p">:</span>
<span class="w"> </span><span class="nt">ims-internal</span><span class="p">:</span>
<span class="w"> </span><span class="nt">ipv4_address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.20.0.2</span>
<span class="w"> </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql-data:/var/lib/mysql</span> <span class="w"> </span><span class="nt">icscf</span><span class="p">:</span>
<span class="w"> </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./ims</span>
<span class="w"> </span><span class="nt">environment</span><span class="p">:</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SERVICE_TYPE=icscf</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DNS_IP=172.20.0.3</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_IP=172.20.0.2</span>
<span class="w"> </span><span class="nt">networks</span><span class="p">:</span>
<span class="w"> </span><span class="nt">ims-internal</span><span class="p">:</span>
<span class="w"> </span><span class="nt">ipv4_address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.20.0.4</span>
<span class="w"> </span><span class="nt">ims-external</span><span class="p">:</span>
<span class="w"> </span><span class="nt">ports</span><span class="p">:</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;4060:4060/udp&quot;</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;4060:4060/tcp&quot;</span> <span class="nt">networks</span><span class="p">:</span>
<span class="w"> </span><span class="nt">ims-internal</span><span class="p">:</span>
<span class="w"> </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
<span class="w"> </span><span class="nt">ipam</span><span class="p">:</span>
<span class="w"> </span><span class="nt">config</span><span class="p">:</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.20.0.0/24</span>
<span class="w"> </span><span class="nt">ims-external</span><span class="p">:</span>
<span class="w"> </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</code></pre></div> <h3>DNS Service Integration</h3>
<p>Containerized DNS service for internal service discovery:</p>
<div class="codehilite"><pre><span></span><code><span class="c"># dns/Dockerfile</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">ubuntu:20.04</span> <span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>bind9<span class="w"> </span>bind9utils
<span class="k">COPY</span><span class="w"> </span>named.conf.options<span class="w"> </span>/etc/bind/
<span class="k">COPY</span><span class="w"> </span>named.conf.local.tpl<span class="w"> </span>/templates/ <span class="k">RUN</span><span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/var/cache/bind<span class="w"> </span>/var/log/bind
<span class="k">RUN</span><span class="w"> </span>chown<span class="w"> </span>bind:bind<span class="w"> </span>/var/cache/bind<span class="w"> </span>/var/log/bind <span class="k">COPY</span><span class="w"> </span>start-dns.sh<span class="w"> </span>/start-dns.sh
<span class="k">RUN</span><span class="w"> </span>chmod<span class="w"> </span>+x<span class="w"> </span>/start-dns.sh <span class="k">EXPOSE</span><span class="w"> </span><span class="s">53/udp 53/tcp</span>
<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/start-dns.sh&quot;</span><span class="p">]</span>
</code></pre></div> <h2>Health Checks and Monitoring</h2>
<h3>Container Health Checks</h3>
<p>Implemented comprehensive health checking for each IMS component:</p>
<div class="codehilite"><pre><span></span><code><span class="c"># Health check for I-CSCF</span>
<span class="k">HEALTHCHECK</span><span class="w"> </span>--interval<span class="o">=</span>30s<span class="w"> </span>--timeout<span class="o">=</span>5s<span class="w"> </span>--start-period<span class="o">=</span>40s<span class="w"> </span>--retries<span class="o">=</span><span class="m">3</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>CMD<span class="w"> </span>kamctl<span class="w"> </span>stats<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;uptime&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
</code></pre></div> <h3>Custom Health Check Scripts</h3>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># health-check.sh for IMS services</span> <span class="nv">SERVICE_TYPE</span><span class="o">=</span><span class="si">${</span><span class="nv">SERVICE_TYPE</span><span class="k">:-</span><span class="s2">&quot;icscf&quot;</span><span class="si">}</span> <span class="k">case</span><span class="w"> </span><span class="nv">$SERVICE_TYPE</span><span class="w"> </span><span class="k">in</span>
<span class="w"> </span><span class="s2">&quot;icscf&quot;</span><span class="o">)</span>
<span class="w"> </span><span class="c1"># Check if Kamailio is running and responding</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span>pgrep<span class="w"> </span>kamailio<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ERROR: Kamailio process not found&quot;</span>
<span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w"> </span><span class="k">fi</span> <span class="w"> </span><span class="c1"># Check database connectivity</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span>mysql<span class="w"> </span>-h<span class="si">${</span><span class="nv">MYSQL_IP</span><span class="si">}</span><span class="w"> </span>-uicscf<span class="w"> </span>-p<span class="si">${</span><span class="nv">MYSQL_PASSWORD</span><span class="si">}</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;SELECT 1&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ERROR: Database connection failed&quot;</span>
<span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w"> </span><span class="k">fi</span> <span class="w"> </span><span class="c1"># Check SIP interface</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span>netstat<span class="w"> </span>-ln<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;:4060&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ERROR: SIP port not listening&quot;</span>
<span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>
<span class="w"> </span><span class="k">fi</span>
<span class="w"> </span><span class="p">;;</span> <span class="w"> </span><span class="s2">&quot;pcscf&quot;</span><span class="o">)</span>
<span class="w"> </span><span class="c1"># P-CSCF specific health checks</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span>curl<span class="w"> </span>-f<span class="w"> </span>http://localhost:8080/stats<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ERROR: Statistics interface not responding&quot;</span>
<span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w"> </span><span class="k">fi</span>
<span class="w"> </span><span class="p">;;</span>
<span class="k">esac</span> <span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Health check passed for </span><span class="nv">$SERVICE_TYPE</span><span class="s2">&quot;</span>
<span class="nb">exit</span><span class="w"> </span><span class="m">0</span>
</code></pre></div> <h2>Security Hardening</h2>
<h3>Container Security Best Practices</h3>
<p><strong>1. Non-Root Execution</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">RUN</span><span class="w"> </span>groupadd<span class="w"> </span>-r<span class="w"> </span>kamailio<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>useradd<span class="w"> </span>-r<span class="w"> </span>-g<span class="w"> </span>kamailio<span class="w"> </span>kamailio
<span class="k">RUN</span><span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>kamailio:kamailio<span class="w"> </span>/etc/kamailio<span class="w"> </span>/var/log/kamailio <span class="k">USER</span><span class="w"> </span><span class="s">kamailio</span>
</code></pre></div> <p><strong>2. Minimal Attack Surface</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># Remove unnecessary packages and files</span>
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>remove<span class="w"> </span>-y<span class="w"> </span>build-essential<span class="w"> </span>gcc<span class="w"> </span>g++<span class="w"> </span>make<span class="w"> </span><span class="se">\</span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>autoremove<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/var/lib/apt/lists/*<span class="w"> </span>/tmp/*<span class="w"> </span>/var/tmp/* <span class="c"># Remove setuid/setgid binaries</span>
<span class="k">RUN</span><span class="w"> </span>find<span class="w"> </span>/<span class="w"> </span>-perm<span class="w"> </span>+6000<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span>a-s<span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span>true
</code></pre></div> <p><strong>3. Secrets Management</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># docker-compose.yml</span>
<span class="nt">secrets</span><span class="p">:</span>
<span class="w"> </span><span class="nt">mysql_password</span><span class="p">:</span>
<span class="w"> </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./secrets/mysql_password.txt</span>
<span class="w"> </span><span class="nt">tls_certificate</span><span class="p">:</span>
<span class="w"> </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./secrets/ims.crt</span> <span class="nt">services</span><span class="p">:</span>
<span class="w"> </span><span class="nt">icscf</span><span class="p">:</span>
<span class="w"> </span><span class="nt">secrets</span><span class="p">:</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql_password</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tls_certificate</span>
<span class="w"> </span><span class="nt">environment</span><span class="p">:</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_PASSWORD_FILE=/run/secrets/mysql_password</span>
</code></pre></div> <h2>Performance Optimization</h2>
<h3>Resource Limits and Requests</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># docker-compose.yml - Resource management</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w"> </span><span class="nt">icscf</span><span class="p">:</span>
<span class="w"> </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w"> </span><span class="nt">resources</span><span class="p">:</span>
<span class="w"> </span><span class="nt">limits</span><span class="p">:</span>
<span class="w"> </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;2.0&#39;</span>
<span class="w"> </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1G</span>
<span class="w"> </span><span class="nt">reservations</span><span class="p">:</span>
<span class="w"> </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.5&#39;</span><span class="w"> </span>
<span class="w"> </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256M</span>
<span class="w"> </span><span class="nt">ulimits</span><span class="p">:</span>
<span class="w"> </span><span class="nt">nofile</span><span class="p">:</span>
<span class="w"> </span><span class="nt">soft</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">65536</span>
<span class="w"> </span><span class="nt">hard</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">65536</span>
</code></pre></div> <h3>Kernel Parameter Tuning</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Optimize for high-performance networking</span>
<span class="k">RUN</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;net.core.rmem_max = 16777216&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/sysctl.conf<span class="w"> </span><span class="se">\</span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;net.core.wmem_max = 16777216&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/sysctl.conf<span class="w"> </span><span class="se">\</span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;net.ipv4.tcp_rmem = 4096 87380 16777216&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/sysctl.conf
</code></pre></div> <h2>Deployment and Orchestration</h2>
<h3>Blue-Green Deployment Strategy</h3>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># deploy.sh - Blue-green deployment script</span> <span class="nv">CURRENT_ENV</span><span class="o">=</span><span class="k">$(</span>docker-compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.yml<span class="w"> </span>ps<span class="w"> </span>-q<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="k">)</span> <span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CURRENT_ENV</span><span class="s2">&quot;</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Initial deployment...&quot;</span>
<span class="w"> </span>docker-compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.yml<span class="w"> </span>up<span class="w"> </span>-d
<span class="k">else</span>
<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Blue-green deployment...&quot;</span> <span class="w"> </span><span class="c1"># Start new environment (green)</span>
<span class="w"> </span>docker-compose<span class="w"> </span>-f<span class="w"> </span>docker-compose-green.yml<span class="w"> </span>up<span class="w"> </span>-d <span class="w"> </span><span class="c1"># Health check new environment</span>
<span class="w"> </span>sleep<span class="w"> </span><span class="m">30</span>
<span class="w"> </span>./health-check-all.sh<span class="w"> </span>green <span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$?</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Green environment healthy, switching traffic...&quot;</span> <span class="w"> </span><span class="c1"># Update load balancer configuration</span>
<span class="w"> </span>./update-lb-config.sh<span class="w"> </span>green <span class="w"> </span><span class="c1"># Stop old environment (blue)</span>
<span class="w"> </span>docker-compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.yml<span class="w"> </span>down <span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Deployment completed successfully&quot;</span>
<span class="w"> </span><span class="k">else</span>
<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Green environment unhealthy, rolling back...&quot;</span>
<span class="w"> </span>docker-compose<span class="w"> </span>-f<span class="w"> </span>docker-compose-green.yml<span class="w"> </span>down
<span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w"> </span><span class="k">fi</span>
<span class="k">fi</span>
</code></pre></div> <h2>Monitoring and Logging</h2>
<h3>Structured Logging</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># kamailio logging configuration</span>
<span class="nv">log_stderror</span><span class="o">=</span>no
<span class="nv">log_facility</span><span class="o">=</span>LOG_LOCAL0
<span class="nv">log_prefix</span><span class="o">=</span><span class="s2">&quot;{</span><span class="nv">$mt</span><span class="s2"> </span><span class="nv">$hdr</span><span class="s2">(call-id) </span><span class="nv">$ci</span><span class="s2">} &quot;</span> <span class="c1"># JSON structured logging for containers</span>
xlog<span class="o">(</span><span class="s2">&quot;L_INFO&quot;</span>,<span class="w"> </span><span class="s2">&quot;{ \&quot;timestamp\&quot;: \&quot;</span><span class="nv">$TS</span><span class="s2">\&quot;, \&quot;call_id\&quot;: \&quot;</span><span class="nv">$ci</span><span class="s2">\&quot;, </span>
<span class="s2"> \&quot;method\&quot;: \&quot;</span><span class="nv">$rm</span><span class="s2">\&quot;, \&quot;from\&quot;: \&quot;</span><span class="nv">$fu</span><span class="s2">\&quot;, \&quot;to\&quot;: \&quot;</span><span class="nv">$tu</span><span class="s2">\&quot;, </span>
<span class="s2"> \&quot;src_ip\&quot;: \&quot;</span><span class="nv">$si</span><span class="s2">\&quot;, \&quot;action\&quot;: \&quot;request_received\&quot; }\n&quot;</span><span class="o">)</span><span class="p">;</span>
</code></pre></div> <h3>Metrics Collection</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Prometheus metrics exposition</span>
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>prometheus-node-exporter
<span class="k">COPY</span><span class="w"> </span>kamailio-exporter.py<span class="w"> </span>/usr/local/bin/
<span class="k">EXPOSE</span><span class="w"> </span><span class="s">9100 9150</span> <span class="c"># Start metrics collection alongside main process</span>
<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/bin/bash&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-c&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;/usr/local/bin/kamailio-exporter.py &amp; exec /entrypoint.sh&quot;</span><span class="p">]</span>
</code></pre></div> <h2>Production Deployment Results</h2>
<h3>Performance Metrics</h3>
<p><strong>Before Containerization:</strong>
- Deployment time: 45 minutes
- Recovery time: 15 minutes<br />
- Resource utilization: 40%
- Scaling time: Manual, 2+ hours</p>
<p><strong>After Containerization:</strong>
- Deployment time: 3 minutes (93% improvement)
- Recovery time: 30 seconds (97% improvement)
- Resource utilization: 75% (87% improvement)
- Scaling time: Automated, 1 minute (99% improvement)</p>
<h3>Operational Benefits</h3>
<p><strong>Consistency</strong>: Identical environments from dev to production
<strong>Portability</strong>: Easy migration between data centers
<strong>Scalability</strong>: Horizontal scaling based on traffic patterns
<strong>Reliability</strong>: Automatic restart and health checking
<strong>Security</strong>: Isolated processes with minimal attack surface</p>
<h2>Lessons Learned</h2>
<h3>1. Start with Understanding</h3>
<p>Before containerizing any telecommunications application:
- Map all network interfaces and protocols
- Document service dependencies and communication patterns
- Identify stateful vs stateless components
- Understand performance and latency requirements</p>
<h3>2. Configuration is Critical</h3>
<p>For IMS systems, configuration management is often more complex than the application itself:
- Invest heavily in template systems
- Validate configurations before deployment
- Test configuration changes in isolated environments
- Version control all configuration templates</p>
<h3>3. Networking Requires Special Attention</h3>
<p>Container networking for VoLTE requires careful planning:
- Understand SIP signaling flows
- Plan IP address allocation carefully
- Consider NAT traversal implications
- Test inter-container communication thoroughly</p>
<h3>4. Monitoring is Essential</h3>
<p>The distributed nature of containerized IMS requires enhanced monitoring:
- Implement comprehensive health checks
- Use structured logging for correlation
- Monitor both infrastructure and application metrics
- Set up alerting for critical service failures</p>
<h2>Best Practices for Telecom Containerization</h2>
<h3>1. Security First</h3>
<ul>
<li>Run containers as non-root users</li>
<li>Use minimal base images</li>
<li>Regularly scan for vulnerabilities</li>
<li>Implement proper secrets management</li>
<li>Network segmentation between services</li>
</ul>
<h3>2. Performance Optimization</h3>
<ul>
<li>Right-size resource allocations</li>
<li>Use appropriate restart policies</li>
<li>Implement proper health checks</li>
<li>Monitor resource utilization continuously</li>
<li>Optimize container startup times</li>
</ul>
<h3>3. High Availability Design</h3>
<ul>
<li>Design for failure scenarios</li>
<li>Implement graceful degradation</li>
<li>Use multi-zone deployments</li>
<li>Plan for disaster recovery</li>
<li>Test failover procedures regularly</li>
</ul>
<h3>4. Configuration Management</h3>
<ul>
<li>Externalize all configuration</li>
<li>Use configuration validation</li>
<li>Implement configuration drift detection</li>
<li>Version control configuration changes</li>
<li>Test configuration changes thoroughly</li>
</ul>
<h2>Future Enhancements</h2>
<h3>Short-term Goals</h3>
<ol>
<li><strong>Kubernetes Migration</strong>: Moving from Docker Compose to Kubernetes</li>
<li><strong>Service Mesh</strong>: Implementing Istio for advanced traffic management </li>
<li><strong>Observability</strong>: Enhanced monitoring with Prometheus and Grafana</li>
<li><strong>Automation</strong>: GitOps deployment pipelines</li>
</ol>
<h3>Long-term Vision</h3>
<ol>
<li><strong>Multi-Cloud</strong>: Preparing for multi-cloud deployment scenarios</li>
<li><strong>Edge Computing</strong>: Optimizing for edge deployment patterns</li>
<li><strong>5G SA</strong>: Extending architecture for 5G Standalone networks</li>
<li><strong>AI/ML Integration</strong>: Intelligent scaling and optimization</li>
</ol>
<h2>Conclusion</h2>
<p>Containerizing critical VoLTE infrastructure has transformed our deployment capabilities while maintaining the reliability that telecommunications services demand. The key to success was treating containerization not just as a packaging exercise, but as a comprehensive modernization of our deployment, monitoring, and operational practices.</p>
<p>The benefits we've achieved – 93% faster deployments, 97% faster recovery, and significantly improved resource utilization – demonstrate that containers can be successfully applied to even the most demanding telecommunications workloads.</p>
<p>For organizations considering similar transformations, I recommend:</p>
<ol>
<li><strong>Invest time in understanding your application architecture</strong> before starting</li>
<li><strong>Plan your configuration management strategy</strong> carefully</li>
<li><strong>Design comprehensive health checking and monitoring</strong> from the beginning</li>
<li><strong>Test thoroughly</strong> in environments that match production networking</li>
<li><strong>Train your operations teams</strong> on container-based troubleshooting</li>
</ol>
<p>The telecommunications industry is rapidly adopting cloud-native technologies. By containerizing our IMS infrastructure, we've positioned our VoLTE services for future innovation while maintaining the rock-solid reliability our customers expect.</p>
<hr />
<p><em>This containerization project has served as a foundation for modernizing additional network functions across our telecommunications platform. The patterns and practices established continue to drive efficiency and reliability improvements throughout our infrastructure.</em></p></div> <footer><ul class="stats"><li><a href="../index.html">Back to posts</a></li></ul></footer> </article> </div> <section id="sidebar"> <section> <div class="mini-posts"> <header><h3>Recent</h3></header> <ul>
<li><a href="../posts/project--telecommunications-infrastructure-blog.html">Building Robust Telecommunications Infrastructure: A Deep Dive into MSISDN Management and SIM Provisioning</a> <span class=\"published\">Infra</span></li>
<li><a href="../posts/project-new--devops-automation-blog.html">DevOps Automation in Telecommunications: Building Resilient Monitoring Workflows with GitHub Actions</a> <span class=\"published\">DevOps</span></li>
<li><a href="../posts/project-new--prometheus-integration-blog.html">Mastering Prometheus Integration: From Batch Jobs to Production Monitoring</a> <span class=\"published\">Monitoring</span></li>
<li><a href="../posts/project-new--telecommunications-monitoring-blog.html">Automating Telecommunications Infrastructure Monitoring: A DevOps Approach to MSISDN Stock Management</a> <span class=\"published\">Monitoring</span></li>
<li><a href="../posts/project--cicd-pipeline-blog.html">Building Rock-Solid CI/CD Pipelines for Mission-Critical Telecommunications Infrastructure</a> <span class=\"published\">DevOps</span></li> </ul> </div> </section> <section> <header><h3>About</h3></header> <p>Notes on telecom, infra, and automation.</p> </section> </section> <section id="footer"><p class="copyright">&copy; 2025</p></section> </div> <script src="../assets/js/jquery.min.js"></script> <script src="../assets/js/browser.min.js"></script> <script src="../assets/js/breakpoints.min.js"></script> <script src="../assets/js/util.js"></script> <script src="../assets/js/main.js"></script> </body>
</html>