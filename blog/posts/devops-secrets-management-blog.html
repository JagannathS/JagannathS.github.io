<!DOCTYPE HTML>
<html> <head> <title>DevOps Security: From Hardcoded Secrets to Vault Integration - Future Imperfect</title> <meta charset="utf-8" /> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" /> <link rel="stylesheet" href="../assets/css/main.css" /> <link rel="stylesheet" href="../assets/css/codehilite.css" /> </head> <body class="single is-preload"> <div id="wrapper"> <header id="header"> <h1><a href="../index.html">Future Imperfect</a></h1> <nav class="links"></nav> </header> <div id="main"> <article class="post"> <header> <div class="title"><h2>DevOps Security: From Hardcoded Secrets to Vault Integration</h2><p>One of the most critical aspects of production deployment is secure secrets management. This post chronicles the journey from hardcoded credentials to a production-ready Vault integration, highlighting the security improvements and operational benefits achieved.</p></div> <div class="meta"><span class="published">DevOps</span></div> </header> <div class="content markdown"><h1>DevOps Security: From Hardcoded Secrets to Vault Integration</h1>
<h2>Introduction</h2>
<p>One of the most critical aspects of production deployment is secure secrets management. This post chronicles the journey from hardcoded credentials to a production-ready Vault integration, highlighting the security improvements and operational benefits achieved.</p>
<h2>The Problem: Hardcoded Secrets Anti-Pattern</h2>
<h3>Initial State (The Bad)</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># meta-dev.yml - Initial approach (NEVER DO THIS)</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w"> </span><span class="nt">containers</span><span class="p">:</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wireless-exporter</span>
<span class="w"> </span><span class="nt">env</span><span class="p">:</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WIRELESS_USER</span>
<span class="w"> </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;postgres_user&quot;</span><span class="w"> </span><span class="c1"># ❌ Hardcoded</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WIRELESS_PASSWORD</span><span class="w"> </span>
<span class="w"> </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;super_secret_password&quot;</span><span class="w"> </span><span class="c1"># ❌ Exposed in Git</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WIRELESS_HOST</span>
<span class="w"> </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;replica-postgres-main-14.query.consul&quot;</span>
</code></pre></div> <p><strong>Problems with this approach:</strong>
- Secrets exposed in version control
- No rotation capabilities
- Compliance violations
- Security audit failures
- Team members have access to production credentials</p>
<h2>The Evolution: Step-by-Step Security Improvements</h2>
<h3>Phase 1: Environment Variables</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># First improvement - Environment variables</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w"> </span><span class="nt">containers</span><span class="p">:</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wireless-exporter</span>
<span class="w"> </span><span class="nt">env</span><span class="p">:</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WIRELESS_USER</span>
<span class="w"> </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${WIRELESS_USER}&quot;</span><span class="w"> </span><span class="c1"># Better, but still not ideal</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WIRELESS_PASSWORD</span>
<span class="w"> </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${WIRELESS_PASSWORD}&quot;</span>
</code></pre></div> <p><strong>Issues remaining:</strong>
- Environment variables visible in process lists
- Still no proper rotation
- Manual secret distribution</p>
<h3>Phase 2: Kubernetes Secrets</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Better approach - Kubernetes secrets</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w"> </span><span class="nt">containers</span><span class="p">:</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wireless-exporter</span>
<span class="w"> </span><span class="nt">env</span><span class="p">:</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WIRELESS_USER</span>
<span class="w"> </span><span class="nt">valueFrom</span><span class="p">:</span>
<span class="w"> </span><span class="nt">secretKeyRef</span><span class="p">:</span>
<span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wireless-secrets</span>
<span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">username</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WIRELESS_PASSWORD</span>
<span class="w"> </span><span class="nt">valueFrom</span><span class="p">:</span>
<span class="w"> </span><span class="nt">secretKeyRef</span><span class="p">:</span>
<span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wireless-secrets</span><span class="w"> </span>
<span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</code></pre></div> <p><strong>Improvements:</strong>
- Secrets not in application configuration
- Base64 encoded (but not encrypted at rest)
- RBAC controlled access</p>
<h3>Phase 3: Vault Integration (The Solution)</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Production-ready approach</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w"> </span><span class="nt">containers</span><span class="p">:</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wireless-exporter</span>
<span class="w"> </span><span class="nt">envFrom</span><span class="p">:</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">secretRef</span><span class="p">:</span>
<span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wireless-secrets</span><span class="w"> </span><span class="c1"># Vault-managed secret</span>
</code></pre></div> <h2>Vault Implementation Details</h2>
<h3>Vault Configuration Structure</h3>
<div class="codehilite"><pre><span></span><code><span class="n">vault</span><span class="o">-</span><span class="n">ha</span><span class="o">-</span><span class="n">prod</span><span class="o">.</span><span class="n">internal</span><span class="o">.</span><span class="n"></span><span class="o">.</span><span class="n">com</span><span class="o">/</span>
<span class="err">├──</span><span class="w"> </span><span class="n">secret</span><span class="o">/</span>
<span class="err">│</span><span class="w"> </span><span class="err">└──</span><span class="w"> </span><span class="n">wireless</span><span class="o">-</span><span class="n">query</span><span class="o">-</span><span class="n">exporter</span><span class="o">/</span>
<span class="err">│</span><span class="w"> </span><span class="err">├──</span><span class="w"> </span><span class="n">WIRELESS_USER</span>
<span class="err">│</span><span class="w"> </span><span class="err">├──</span><span class="w"> </span><span class="n">WIRELESS_PASSWORD</span>
<span class="err">│</span><span class="w"> </span><span class="err">├──</span><span class="w"> </span><span class="n">WIRELESS_BILLING_USER</span>
<span class="err">│</span><span class="w"> </span><span class="err">└──</span><span class="w"> </span><span class="n">WIRELESS_BILLING_PASSWORD</span>
</code></pre></div> <h3>Application Integration</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># main.py - Environment-based configuration</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span> <span class="k">class</span><span class="w"> </span><span class="nc">HealthQueryExporterScript</span><span class="p">(</span><span class="n">QueryExporterScript</span><span class="p">):</span> <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_config_from_env</span><span class="p">()</span> <span class="k">def</span><span class="w"> </span><span class="nf">_load_config_from_env</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w"> </span><span class="sd">&quot;&quot;&quot;Load configuration from environment variables populated by Vault&quot;&quot;&quot;</span> <span class="k">return</span> <span class="p">{</span> <span class="s1">&#39;wireless_user&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WIRELESS_USER&#39;</span><span class="p">),</span> <span class="s1">&#39;wireless_password&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WIRELESS_PASSWORD&#39;</span><span class="p">),</span> <span class="s1">&#39;wireless_host&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WIRELESS_HOST&#39;</span><span class="p">,</span> <span class="s1">&#39;replica-postgres-main-14.query.consul&#39;</span><span class="p">),</span> <span class="s1">&#39;wireless_port&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WIRELESS_PORT&#39;</span><span class="p">,</span> <span class="s1">&#39;5432&#39;</span><span class="p">)),</span> <span class="p">}</span>
</code></pre></div> <h3>Deployment Configuration</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># meta-prod.yml - Final production configuration</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w"> </span><span class="nt">template</span><span class="p">:</span>
<span class="w"> </span><span class="nt">spec</span><span class="p">:</span>
<span class="w"> </span><span class="nt">containers</span><span class="p">:</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wireless-exporter</span>
<span class="w"> </span><span class="nt">envFrom</span><span class="p">:</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">secretRef</span><span class="p">:</span>
<span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wireless-secrets</span><span class="w"> </span><span class="c1"># Managed by Vault Operator</span>
<span class="w"> </span><span class="nt">env</span><span class="p">:</span>
<span class="w"> </span><span class="c1"># Static configuration (non-sensitive)</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WIRELESS_HOST</span>
<span class="w"> </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;replica-postgres-main-14.query.consul&quot;</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WIRELESS_PORT</span>
<span class="w"> </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;5432&quot;</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WIRELESS_DB</span>
<span class="w"> </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wireless_manager&quot;</span>
</code></pre></div> <h2>Security Benefits Achieved</h2>
<h3>1. <strong>Secret Rotation</strong></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Vault CLI - Easy secret rotation</span>
vault<span class="w"> </span>kv<span class="w"> </span>put<span class="w"> </span>secret/wireless-query-exporter<span class="w"> </span><span class="se">\</span>
<span class="w"> </span><span class="nv">WIRELESS_USER</span><span class="o">=</span><span class="s2">&quot;new_username&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span><span class="nv">WIRELESS_PASSWORD</span><span class="o">=</span><span class="s2">&quot;new_rotated_password&quot;</span> <span class="c1"># Application picks up new secrets on next deployment/restart</span>
kubectl<span class="w"> </span>rollout<span class="w"> </span>restart<span class="w"> </span>deployment/wireless-exporter
</code></pre></div> <h3>2. <strong>Access Control</strong></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Vault policy - wireless-query-exporter-policy.hcl</span>
<span class="err">path</span><span class="w"> </span><span class="s2">&quot;secret/data/wireless-query-exporter&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="na">capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;read&quot;</span><span class="p">]</span>
<span class="p">}</span> <span class="err">path</span><span class="w"> </span><span class="s2">&quot;secret/metadata/wireless-query-exporter&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="na">capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;list&quot;, &quot;read&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div> <h3>3. <strong>Audit Trail</strong></h3>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w"> </span><span class="nt">&quot;time&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2024-01-15T10:30:00Z&quot;</span><span class="p">,</span>
<span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;request&quot;</span><span class="p">,</span>
<span class="w"> </span><span class="nt">&quot;auth&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nt">&quot;client_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;hmac-sha256:xxx&quot;</span><span class="p">,</span>
<span class="w"> </span><span class="nt">&quot;accessor&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;hmac-sha256:yyy&quot;</span>
<span class="w"> </span><span class="p">},</span>
<span class="w"> </span><span class="nt">&quot;request&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;secret/data/wireless-query-exporter&quot;</span><span class="p">,</span>
<span class="w"> </span><span class="nt">&quot;operation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;read&quot;</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div> <h2>Configuration Management Strategy</h2>
<h3>Static vs Secret Configuration</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Static configuration (safe to commit)</span>
<span class="n">STATIC_CONFIG</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;WIRELESS_HOST&#39;</span><span class="p">:</span> <span class="s1">&#39;replica-postgres-main-14.query.consul&#39;</span><span class="p">,</span> <span class="s1">&#39;WIRELESS_PORT&#39;</span><span class="p">:</span> <span class="mi">5432</span><span class="p">,</span> <span class="s1">&#39;WIRELESS_DB&#39;</span><span class="p">:</span> <span class="s1">&#39;wireless_manager&#39;</span><span class="p">,</span> <span class="s1">&#39;WIRELESS_BILLING_HOST&#39;</span><span class="p">:</span> <span class="s1">&#39;replica-postgres-main-14.query.consul&#39;</span><span class="p">,</span> <span class="s1">&#39;WIRELESS_BILLING_PORT&#39;</span><span class="p">:</span> <span class="mi">5432</span><span class="p">,</span> <span class="s1">&#39;WIRELESS_BILLING_DB&#39;</span><span class="p">:</span> <span class="s1">&#39;wireless_billing&#39;</span>
<span class="p">}</span> <span class="c1"># Secret configuration (from Vault)</span>
<span class="n">SECRET_CONFIG</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;WIRELESS_USER&#39;</span><span class="p">,</span> <span class="s1">&#39;WIRELESS_PASSWORD&#39;</span><span class="p">,</span> <span class="s1">&#39;WIRELESS_BILLING_USER&#39;</span><span class="p">,</span> <span class="s1">&#39;WIRELESS_BILLING_PASSWORD&#39;</span>
<span class="p">]</span>
</code></pre></div> <h3>Environment-Specific Deployment</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Different Vault paths for different environments</span>
<span class="c1"># Development</span>
<span class="nt">envFrom</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">secretRef</span><span class="p">:</span>
<span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wireless-secrets-dev</span><span class="w"> </span><span class="c1"># Points to vault-ha-dev.internal</span> <span class="c1"># Production </span>
<span class="nt">envFrom</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">secretRef</span><span class="p">:</span>
<span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wireless-secrets</span><span class="w"> </span><span class="c1"># Points to vault-ha-prod.internal</span>
</code></pre></div> <h2>Operational Improvements</h2>
<h3>1. <strong>Automated Secret Distribution</strong></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Vault Operator automatically syncs secrets</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wireless-secrets</span>
<span class="w"> </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w"> </span><span class="nt">vault.security.banzaicloud.io/vault-addr</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://vault-ha-prod.internal&quot;</span>
<span class="w"> </span><span class="nt">vault.security.banzaicloud.io/vault-path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;secret/data/wireless-query-exporter&quot;</span>
<span class="w"> </span><span class="nt">vault.security.banzaicloud.io/vault-role</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wireless-query-exporter&quot;</span>
<span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Opaque</span>
</code></pre></div> <h3>2. <strong>Local Development Setup</strong></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># .env.local (gitignored)</span>
<span class="nv">WIRELESS_USER</span><span class="o">=</span>dev_user
<span class="nv">WIRELESS_PASSWORD</span><span class="o">=</span>dev_password
<span class="nv">WIRELESS_BILLING_USER</span><span class="o">=</span>billing_dev_user<span class="w"> </span>
<span class="nv">WIRELESS_BILLING_PASSWORD</span><span class="o">=</span>billing_dev_password <span class="c1"># docker-compose.yml </span>
services:
<span class="w"> </span>wireless-exporter:
<span class="w"> </span>env_file:
<span class="w"> </span>-<span class="w"> </span>.env.local<span class="w"> </span><span class="c1"># Local development secrets</span>
</code></pre></div> <h3>3. <strong>CI/CD Integration</strong></h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// Jenkinsfile</span>
<span class="n">pipeline</span><span class="w"> </span><span class="o">{</span>
<span class="w"> </span><span class="n">stages</span><span class="w"> </span><span class="o">{</span>
<span class="w"> </span><span class="n">stage</span><span class="o">(</span><span class="s1">&#39;Deploy&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w"> </span><span class="n">steps</span><span class="w"> </span><span class="o">{</span>
<span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="o">{</span>
<span class="w"> </span><span class="c1">// Vault authentication in CI</span>
<span class="w"> </span><span class="n">sh</span><span class="w"> </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2"> vault auth -method=aws</span>
<span class="s2"> vault read -field=status secret/wireless-query-exporter</span>
<span class="s2"> kubectl apply -f meta-prod.yml</span>
<span class="s2"> &quot;&quot;&quot;</span>
<span class="w"> </span><span class="o">}</span>
<span class="w"> </span><span class="o">}</span>
<span class="w"> </span><span class="o">}</span>
<span class="w"> </span><span class="o">}</span>
<span class="o">}</span>
</code></pre></div> <h2>Best Practices Implemented</h2>
<h3>1. <strong>Principle of Least Privilege</strong></h3>
<ul>
<li>Each environment has separate Vault paths</li>
<li>Service accounts have minimal required permissions</li>
<li>Regular access reviews and cleanup</li>
</ul>
<h3>2. <strong>Secret Hygiene</strong></h3>
<ul>
<li>No secrets in git history (verified with tools like git-secrets)</li>
<li>Regular secret rotation schedule</li>
<li>Temporary secrets for development</li>
</ul>
<h3>3. <strong>Monitoring &amp; Alerting</strong></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Prometheus alert for secret access</span>
<span class="nt">groups</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vault.rules</span>
<span class="w"> </span><span class="nt">rules</span><span class="p">:</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VaultSecretAccessFailure</span>
<span class="w"> </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">increase(vault_audit_log_request_failure_total[5m]) &gt; 0</span>
<span class="w"> </span><span class="nt">labels</span><span class="p">:</span>
<span class="w"> </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<span class="w"> </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w"> </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Failed</span><span class="nv"> </span><span class="s">Vault</span><span class="nv"> </span><span class="s">secret</span><span class="nv"> </span><span class="s">access</span><span class="nv"> </span><span class="s">detected&quot;</span>
</code></pre></div> <h2>Migration Checklist</h2>
<p>For teams implementing similar improvements:</p>
<h3>Pre-Migration</h3>
<ul>
<li>[ ] <strong>Audit current secret usage</strong> - Identify all hardcoded credentials</li>
<li>[ ] <strong>Set up Vault infrastructure</strong> - Install and configure Vault</li>
<li>[ ] <strong>Create secret policies</strong> - Define access control</li>
<li>[ ] <strong>Test in development</strong> - Validate the integration</li>
</ul>
<h3>Migration Steps</h3>
<ul>
<li>[ ] <strong>Create Vault secrets</strong> - Migrate credentials to Vault</li>
<li>[ ] <strong>Update application code</strong> - Environment variable integration</li>
<li>[ ] <strong>Deploy Vault operator</strong> - Automate secret synchronization </li>
<li>[ ] <strong>Update deployment configs</strong> - Remove hardcoded values</li>
<li>[ ] <strong>Verify functionality</strong> - Test secret rotation</li>
</ul>
<h3>Post-Migration</h3>
<ul>
<li>[ ] <strong>Document procedures</strong> - Secret rotation and access</li>
<li>[ ] <strong>Set up monitoring</strong> - Alert on access failures</li>
<li>[ ] <strong>Train team members</strong> - Vault usage and best practices</li>
<li>[ ] <strong>Regular audits</strong> - Review access and rotate secrets</li>
</ul>
<h2>Lessons Learned</h2>
<h3>1. <strong>Start Simple, Iterate</strong></h3>
<p>Don't try to implement perfect security on day one. Incremental improvements are better than analysis paralysis.</p>
<h3>2. <strong>Environment Parity</strong></h3>
<p>Ensure development and production use the same secret management approach to catch issues early.</p>
<h3>3. <strong>Documentation is Critical</strong></h3>
<p>Clear procedures for secret access, rotation, and emergency recovery are essential.</p>
<h3>4. <strong>Monitoring Matters</strong></h3>
<p>Failed secret access should trigger alerts - it often indicates misconfigurations or security issues.</p>
<h2>Security Metrics</h2>
<h3>Before Vault Integration:</h3>
<ul>
<li>❌ 100% of secrets hardcoded</li>
<li>❌ 0% secret rotation capability</li>
<li>❌ No access audit trail</li>
<li>❌ Secrets visible in git history</li>
</ul>
<h3>After Vault Integration:</h3>
<ul>
<li>✅ 0% hardcoded secrets</li>
<li>✅ 100% secrets support rotation</li>
<li>✅ Complete audit trail</li>
<li>✅ Zero secrets in version control</li>
</ul>
<h2>Future Enhancements</h2>
<ol>
<li><strong>Dynamic Secrets</strong>: Generate database credentials on-demand</li>
<li><strong>Secret Scanning</strong>: Automated detection of exposed secrets</li>
<li><strong>Rotation Automation</strong>: Automated secret rotation schedules</li>
<li><strong>Emergency Procedures</strong>: Break-glass access for incident response</li>
</ol>
<h2>Conclusion</h2>
<p>Migrating from hardcoded secrets to Vault integration represents a fundamental security improvement that pays dividends in:</p>
<ul>
<li><strong>Compliance</strong>: Meeting security audit requirements</li>
<li><strong>Operations</strong>: Simplified secret rotation and distribution</li>
<li><strong>Security</strong>: Proper access control and audit trails</li>
<li><strong>Team Confidence</strong>: Developers can deploy without security concerns</li>
</ul>
<p>The key lesson: <strong>Security improvements can be implemented incrementally without disrupting development velocity</strong>. Start with identifying the most critical secrets and migrate them first.</p>
<p>Remember: The best security practices are the ones your team will actually follow consistently.</p>
<hr />
<p><em>This security migration eliminated 14 lines of hardcoded secrets and established a foundation for enterprise-grade secret management practices.</em></p></div> <footer><ul class="stats"><li><a href="../index.html">Back to posts</a></li></ul></footer> </article> </div> <section id="sidebar"> <section> <div class="mini-posts"> <header><h3>Recent</h3></header> <ul>
<li><a href="../posts/project--cicd-pipeline-blog.html">Building Robust CI/CD Pipelines for Network Infrastructure Services</a> <span class=\"published\">DevOps</span></li>
<li><a href="../posts/project--coredns-custom-implementation-blog.html">Building Custom CoreDNS Solutions for Enterprise Infrastructure</a> <span class=\"published\">Infra</span></li>
<li><a href="../posts/project--docker-infrastructure-blog.html">Containerizing DNS Services: Docker Infrastructure for Enterprise Networks</a> <span class=\"published\">Containers</span></li>
<li><a href="../posts/project--prometheus-metrics-blog.html">Implementing Prometheus Metrics for DNS Services: A Complete Observability Strategy</a> <span class=\"published\">Monitoring</span></li>
<li><a href="../posts/project--wireless-infrastructure-blog.html">DNS Infrastructure for Wireless Networks: Building Reliable Services for Private PGW Environments</a> <span class=\"published\">Infra</span></li> </ul> </div> </section> <section> <header><h3>About</h3></header> <p>Notes on telecom, infra, and automation.</p> </section> </section> <section id="footer"><p class="copyright">&copy; 2025</p></section> </div> <script src="../assets/js/jquery.min.js"></script> <script src="../assets/js/browser.min.js"></script> <script src="../assets/js/breakpoints.min.js"></script> <script src="../assets/js/util.js"></script> <script src="../assets/js/main.js"></script> </body>
</html>